//
// data definition for bid_engine request
//

option optimize_for = SPEED;

package rubicon.data.bid_engine;

import "common.proto";
import "types.proto";
import "ip.proto";
import "geo.proto";
import "num_types.proto";


//
// user's geo info to be sent to BE
//
message UserGeo_PB {
    optional string                             tz                  = 2;    
    optional rubicon.data.geo.Continent_PB      continent           = 3;    
    optional rubicon.data.geo.Country_PB        country             = 4;    
    optional string                             region              = 5;    
    optional string                             dma                 = 6;
    optional string                             postal_code         = 7;
    optional rubicon.data.common.AnUInt32_PB    area_code           = 8;    
}

//
// network_user_ids
//
message NetworkUserID_PB {
    optional uint32         network_id          = 1;
    optional string         put_cookie          = 2;    // MRK: is this the best name for this attribute?
}

//
// PMP rules 
//
message PMPRule_PB {
    optional uint32         network_id          = 1;
    repeated uint32         seat_ids            = 2;
    repeated uint32         deal_ids            = 3;
}

//
// bid engine's request
//
message Request_PB {
    enum RenderStatus_E {
        UNKNOWN  = 0;
        ON_PAGE  = 1;
        IFRAME   = 2;
    }
    
    optional uint64                                 request_time_msec           = 1;    // time in msec (MRK: currently it is a string in the format of sec.millisec)
    
    optional string                                 impression_uuid             = 2;    
    optional uint32                                 sla                         = 3;
    optional uint32                                 median                      = 4;
    optional rubicon.data.common.MimeType_E         ad_type                     = 5;    // AKA MimeType
    optional uint32                                 account_id                  = 6;    // value part of the account_id in request
    optional uint32                                 site_id                     = 7;    // value part of the site_id in request
    optional uint32                                 zone_id                     = 8;    // value part of the zone_id in request
    optional uint32                                 size_id                     = 9;    // value part of the size_id in request
    optional string                                 site_domain_name            = 10;
    optional string                                 site_name                   = 11;
    optional string                                 site_referer                = 12;
    optional RenderStatus_E                         render_status               = 13 [default = UNKNOWN];
    optional uint32                                 site_channel_id             = 14;
    optional string                                 rubicon_user_id             = 15;
    optional string                                 user_agent                  = 16;
    optional string                                 user_accepted_languages     = 17;
    optional rubicon.data.common.IPAddress_PB       user_ip_address             = 18;
    optional UserGeo_PB                             user_geo                    = 19;   // all geo attributes
    repeated uint32                                 audience_segments           = 20;
    optional string                                 page_position               = 21;
    optional uint64                                 site_session_count          = 22;   
    repeated uint32                                 network_ids                 = 23;
    repeated NetworkUserID_PB                       network_user_ids            = 24;
    repeated uint32                                 advertiser_ids              = 25;
    optional bool                                   private_auction             = 26 [default = false];   
    repeated uint32                                 seat_ids                    = 27;
    repeated PMPRule_PB                             pmp_rules                   = 28;
    repeated rubicon.data.common.KeyValuesPair_PB   url_parameters              = 29;      
    
    optional bool                               market_api_request          = 80 [default = false];  // whether or not this is a market_api request
    
    optional string                             test_behavior               = 100;  // bid engine test. we need a better spec for test_behavior (separate status, enable, ...)
    optional uint32                             test_sla                    = 101;    
}
